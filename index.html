<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- Google Tag Manager -->
<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MPX2857');</script> -->
    <!-- End Google Tag Manager -->
</head>
<link rel="stylesheet" href="style.css">
<body style="height:100vh; padding:0px; margin: 0px;">
    <!-- Google Tag Manager (noscript) -->
<!-- <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPX2857"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> -->
    <!-- End Google Tag Manager (noscript) -->
    <audio src="audio/audio.mp3" id="my_audio" loop="loop" autoplay="autoplay"></audio>
    <section style="" id="main">
    <div>
        <div style="z-index:1000000; pointer-events: none;" id="snow"></div>
        <div id="bg">
            <!-- <img id="introImg" style="position: absolute; max-width:100%; z-index:1;" src="videos/intro.gif" alt=""> -->
            <a id="analytics_introImg"><img id="introImg" style="position: absolute; max-width:100%; z-index:1;" src="videos/GIF-11.gif" alt=""></a>
            <!-- <img style="position: absolute; display:none;" src="videos/GIF2.gif" alt=""> caching the gif file, do not delete this line -->
            <img style="position: absolute; display:none;" src="videos/GIF-22.gif" alt=""> <!-- caching the gif file, do not delete this line -->
            <div id="senderBox" style="display:none; z-index:100;">
                <div style="position:relative">
                <img src="images/name_bg_03.png" style="width: 350px;">
                <span class="senderNameAll" id="senderName"></span>
                </div>
            </div>

        <img src="images/New.png" alt="Background" id="openbg" class="bg">
            <img src="images/christmas_03.png" alt="Background" id="closingbg" style="display:none;">
        </div>
    </div>
        <section id="wishScreen" class="wishing" style="display:none">
            <div style="top:-100% !important;" id="senderBox2">
                <div style="position:relative">
                <img src="images/name_bg_03.png" style="width: 350px;">
                <span class="senderNameAll" id="senderName"></span>
                </div>
                <img style="height: 25%" src="images/sent_03.png">
            </div>
        <div style="position: relative;" id="gifts">
                <div onclick="openGift(this)" class="giftbag">
                    <a id="analytics_gift_bag1"><img class="gb" data-open="images/open.png" data-close="images/potli.png" src="images/potli.png" alt=""  id="gift_bag1"></a>
                    <img id="wishCard1" class="wishCard" src="images/1.png">
                </div>
                <div onclick="openGift(this)" class="giftbag">
                    <a id="analytics_gift_bag2"><img class="gb" data-open="images/open.png" data-close="images/potli.png" src="images/potli.png" alt="" id="gift_bag2"></a>
                    <img id="wishCard2" class="wishCard" src="images/2.png">
                </div>
                <div onclick="openGift(this)" class="giftbag" id="gift_bag3" >
                    <a id="analytics_gift_bag3"><img class="gb" data-open="images/open.png" data-close="images/potli.png" src="images/potli.png" alt="" id="gift_bag3"></a>
                    <img id="wishCard3" class="wishCard" src="images/3.png">
                </div>
                <div onclick="openGift(this)" class="giftbag">
                    <a id="analytics_gift_bag4"><img class="gb" data-open="images/open.png" data-close="images/potli.png" src="images/potli.png" alt="" id="gift_bag4"></a>
                    <img id="wishCard4" class="wishCard" src="images/4.png">
                </div>
        </div>
            <a id="analytics_open_all"><img onclick="openAll(this);" style="position: absolute; left:50%; bottom: -75%; transform: translateX(-50%);" src="images/tap_03_03.gif"></a>
    </section>
    <div style="display:none;" id="santaImg" class="santabase">
        <img src="images/Santabase.png" alt="">
    </div>
    <section style="display:none; position:fixed; bottom:0px; left:0px; width:100vw;" id="share2WaBtn" class="whatsappshare">
        <div  class="whatsapp">
             <label>Share with your loved ones</label><br>
             <input type="text" name="content" id="content" placeholder="Enter your name" class="content" maxlength="20"/>
             <a id="analytics_whatsapp"><button type="submit" onclick="addname();" id="whatsapp_btns">Share <img src="images/whatsapp_icon.svg" width="10%"></button></a>                
        </div>
    </section>
    <script type="text/javascript">
        window.addEventListener("load", function() {
            var senderName = decodeURIComponent(window.location.search);
            senderName = senderName.slice(3, senderName.length);
            senderName = senderName.replace(/-/g, ' ');
            
            var sn = document.getElementsByClassName("senderNameAll");
            for(var s of sn) {
                s.innerText = senderName;
            }
            playVid();
        });
        var bagCount = 0;
        var x = document.getElementById("introImg");
        function playVid() {
            unfade(document.getElementById("senderBox"));
            setTimeout(function(){
                myHandler();
                }, 1000);
        }

        function myHandler() {
            x.addEventListener("click", function () {
                document.getElementById("my_audio").play();
                x.src="videos/GIF-22.gif";
                fade(document.getElementById("senderBox"));
                setTimeout(function(){
                    fade(x);
                    unfade(document.getElementById("wishScreen"));
                    unfade(document.getElementById("santaImg"));
                    unfade(document.getElementById("share2WaBtn"));
                }, 4000);
            });
        }
        
        function fade(element, time=50) {
            var op = 1;  // initial opacity
            var timer = setInterval(function () {
                if (op <= 0.1) {
                    clearInterval(timer);
                    element.style.display = 'none';
                }
                element.style.opacity = op;
                element.style.filter = 'alpha(opacity=' + op * 100 + ")";
                op -= op * 0.1;
            }, time);
        }
        
        function unfade(element, time=50) {
            element.style.opacity = 0;
            var op = 0.1;  // initial opacity
            element.style.display = 'block';
            var timer = setInterval(function () {
                if (op >= 1) {
                    clearInterval(timer);
                }
                element.style.opacity = op;
                element.style.filter = 'alpha(opacity=' + op * 100 + ")";
                op += op * 0.1;
            }, time);
        }
        
        function addname() {
            var name = document.getElementById('content');
            factionName = name.value;
            var url = window.location.origin + window.location.pathname + "?q=" + factionName.replace(/ /g, '-');
            var message = "*" + factionName + "* has sent you surprise gifts! 🎁🎄 %0A*Open this to see what they are* 🌟%0A👇 💁‍♀️💁‍♂️👇%0A";
            var whatsapp = "whatsapp://send?text=" + message + " " + url;
            console.log(url);
            window.open(whatsapp);
        }


        function openAll(el) {
            // fade(el);
            var giftbags = document.getElementsByClassName("giftbag");
            // var l = 1;
            // openGift(giftbags[0]);

            // var loop = setInterval(function(){
            //     openGift(giftbags[l]);

            //     if(l >= giftbags.length-1) {
            //         clearInterval(loop);
            //     }
            //     l++;
            // }, 3500);

            for(var i=0; i<giftbags.length; i++){

                var gcard = document.querySelector(".show");
                try {
                    gcard.classList.remove("show");
                } catch(error) {}

                if(!giftbags[i].classList.contains("opened")) {
                    openGift(giftbags[i]);
                    break;
                }
            }
        }
    

        function openGift(el) {
            var oc = 0;
            var giftbags = document.getElementsByClassName("giftbag");
            var gb,gcard;

            fade(document.getElementById("senderBox2"));
            
            for(var i=0; i<giftbags.length; i++){
                gb = giftbags[i].firstElementChild.firstElementChild;
                gcard = giftbags[i].querySelector(".wishCard")
                
                  gcard.classList.remove("show");
                  if(giftbags[i] == el) {
                      if(!el.classList.contains("opened")) {
                          el.classList.add("opened");
                        }
                        
                        gb.src = gb.dataset.open;
                        gcard.classList.add("show");
                    }

                    if(giftbags[i].classList.contains("opened")) {
                        oc = oc+1;
                    }
            }
            
            if(oc==4) {
                setTimeout(function(){
                fade(document.getElementById("wishScreen"));
                setTimeout(function(){
                    unfade(document.getElementById("closingbg"));
                },50);
            }, 4000);
            }
        }

    </script>
   </section>
</body>

</html>
